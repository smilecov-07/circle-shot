# Практики проекта

В этом документе представлены правила и практики проекта, которые нужно соблюдать при разработке. Основаны они на [лучших практиках](https://docs.godotengine.org/ru/4.x/tutorials/best_practices/index.html) Godot, в том числе применения подхода ООП.

## Переменные

- Стоит делать переменную приватной, если не планируете к ней обращаться извне.
- Также не стоит каждую публичную переменную инкапcулировать (то есть превращать в *свойство*). Это усложняет и замедляет код.
- Используйте `@export` переменные тогда, когда есть смысл вынести значение для редактирования в Инспектор. Примеры:
    - Переменные для настройки баланса.
    - Переменные для объектов, которые встречаются в нескольких экземплярах, требующие индивидуальные настройки.
    - Переменные, которые гораздо проще настроить в редакторе, чем в коде.
- Не забывайте об `@export_range` и других `@export_*` аннотациях. Используйте их, чтобы облегчить редактирование в инспекторе.
- Не стоит хардкодить значения, если не совсем понятно, какой смысл они несут. Лучше вынести в (может даже локальную) константу с осмысленным именем.
- Инициализируйте переменные значением при объявлении, только если вам оно понадобится, и оно не будет перезаписано другим значением до первого использования.

## О статических переменных и методах

- Использование статических переменных в совокупности со статическими методами в целях создания некого синглтона не разрешается.
    - Используйте *автозагрузку*, которая создана для этой цели.
- Можно использовать статические методы для создания некого класса утилит, или же просто сделать полезную функцию доступной без экземпляра.

## Отладочный вывод

- Приветствуется отладочный вывод через `print_verbose()`. Рекомендуется печатать его после завершения действия, но до перехода к следующему.
- Используйте `push_error()`, когда:
    - Произошла ошибка, мешающая дальнейшему процессу (например, ошибка загрузки события).
    - Произошла ошибка, связанная с неправильным поведением (например, метод только для сервера вызван на клиенте).
- Используйте `push_warning()`, когда:
    - Произошла небольшая ошибка, не мешающая работе (например, нет подключения к серверу или потеряно соединение).
    - Произошла ошибка, связанная с неправильным поведением, НО не зависящая от локальной логики (например, получен RPC с неправильными данными). Однако, если это мешает корректной работе, вызовите `push_error()`.
- Оканчивайте любой отладочный вывод на точку или многоточие. Восклицательных знаков лучше избегать.
- Проверки отправителя RPC:
    - Используйте `push_error("This method must be called only by server.")`, если метод должен быть выполнен только как RPC от сервера.
    - Используйте `push_error("Unexpected call on client.")`, если метод должен вызываться только на сервере **И** если есть риск, что он ошибочно вызовется на клиенте (например, RPC с флагом `any_peer`).
    - Если сервер получил RPC не от того клиента (например, игрок попытался подделать действия другого игрока), просто выведите предупреждение и отклоните RPC.

## Форматирование строк

Есть три способа вставить некоторое содержимое в строку.

1. Сложение. Не рекомендуется. Используйте только в самых простых случаях.
2. Форматирование через `%` ([руководство](https://docs.godotengine.org/ru/4.x/tutorials/scripting/gdscript/gdscript_format_string.html)). Очень гибкий и простой способ форматирования, позволяющий манипулировать форматом чисел, отступами и многим чем ещё. Можно использовать везде, но есть случаи, когда третий способ предпочтительнее.
3. Форматирование через `String.format(...)`. Немного сложнее, однако гораздо удобнее при работе с большим количеством заполнителей. Используйте этот способ вместо форматирования через `%`, когда:
    - Форматируете локализуемую строку с двумя или более заполнителями. Переводчик может захотеть поменять порядок слов. С этим способом это возможно без вмешательств в код.
    - Форматируете ОЧЕНЬ большую строку с большим количеством заполнителей. В случае с `%` это будет выглядеть гораздо хуже, чем с этим способом.

## Разное

- Используйте `is_instance_valid()` вместо проверки на `null` или приведения к `bool`. Поведение этой функции стабильно и не будет изменено (в отличии от других способов). Однако можно эту функцию не использовать, если работаете с `RefCounted`.
- Используйте *Уникальные имена сцены* только в сложных вложенных интерфейсах. В остальных местах ограничьтесь обычными `NodePath`.
- Стоит кэшировать выражение в переменную, если оно используется 2 или более раз, или это выражение достаточно сложное.
- В местах, где нужны пути, рекомендуется использовать UID, так как их не надо менять при перемещении файла, на который они указывают.
- Используйте `class_name` только тогда, когда вам нужна типизация или класс достаточно важен. Не стоит каждому скрипту давать `class_name`.
- Оканчивайте все переменные типа `PackedScene` на `_scene`.
- Оканчивайте все переменные, связанные с визуальными эффектами, на `_vfx`. Если эта переменная типа `PackedScene`, оканчивайте её на `_vfx_scene`.

### Пример

```gdscript
if object: # Нестабильно
...
if object == null: # Нестабильно
...
if is_instance_valid(object): # Стабильно
```
